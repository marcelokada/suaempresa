<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>

<script type="text/javascript">

  jQuery(function ($) {
    $("#dtnasc").mask("99/99/9999");
    $("#cpf").mask("999.999.999-99");
    $("#celular").mask("(99)99999-9999");
  });

  function validacaoCalcularIdade(dtnasc) {

    var dtnasc = $('#dtnasc').val();
    var val_acima = $('#val_acima').val();
    var parentesco = $('#parentesco').val();

    var dataAtual = new Date();
    var anoAtual = dataAtual.getFullYear();
    var anoNascParts = dtnasc.split('/');
    var diaNasc = anoNascParts[0];
    var mesNasc = anoNascParts[1];
    var anoNasc = anoNascParts[2];
    var idade = anoAtual - anoNasc;
    var mesAtual = dataAtual.getMonth() + 1;

    if (mesAtual < mesNasc) {
      idade--;
    } else {

      if (mesAtual == mesNasc) {
        if (dataAtual.getDate() < diaNasc) {
          idade--;
        }
      }
    }

    var nasc = dtnasc.replace(/[^0-9]/g, '');
    var dt = nasc.length;

    if (dt <= 7) {
      document.getElementById('dtnasc').focus();
      $('#alerta3').html('<p align="justify"><font color="red">Data inválida!</font></p>');
    } else {

      $('#alerta3').html('<p align="justify"><font color="red">' + idade + '</font></p>');

    }
  }

  jQuery(function ($) {
    $("#dtnasc").mask("99/99/9999");
    $("#cpf").mask("999.999.999-99");
    $("#phone").mask("(99) 99999-9999");

  });

  function abrirmodal(id) {
    $('#idusu').val(id);
    $("#delusua").modal('show');
  }

  function apagar() {

    var id = $('#idusu').val();
    var idusua = id;

    $.post('delusuariom.php', {idusua: idusua}, function (data) {
      //alert(data);
      alert('Membro deletado com sucesso.');
      window.location.href = window.location.href
    });
  }


  function editmodal(id) {

    let idusu = id;

    $('#idusua1').val(id);

    $.post('listarmembro.php', {idusu: idusu}, function (data) {

      $("#nome1").val(data.nome);

      $("#para").html('<select class="form-control " id="parentesco1" name="parentesco1" required>' +
        '<option value="' + data.tipo + '">' + data.tiponome + '</option>' +
        ' <option value="" disabled></option>\n' +
        ' <option value="m" >Marido</option>\n' +
        ' <option value="e" >Esposa</option>\n' +
        ' <option value="f" >Filha(o) {TEXTOFILHO}</option>\n' +
        ' <option value="n" >Neta(o)</option>\n' +
        ' <option value="p" >Pai</option>\n' +
        ' <option value="a" >Mãe</option>\n' +
        ' <option value="i" >Irmão(ã)</option>\n' +
        ' <option value="s" >Sogro(a)</option>\n' +
        ' <option value="u" >Cunhado(a)</option>\n' +
        ' </select>');


      $("#grau").html('<select class="form-control" name="grau1"  id="grau1" required>  \n' +
        '<option value="' + data.grau + '">' + data.graunome + '</option>' +
        '<option value="" disabled></option>\n' +
        '<option value="d">Dependente</option>\n' +
        '<option value="a">Agragado</option>\n' +
        ' </select>');

      $("#editmodal").modal('show');
    }, 'json');
  }


  function alterar() {

    var idusua = $('#idusua1').val();
    var nome1 = $('#nome1').val();
    var parentesco1 = $('#parentesco1').val();
    var grau1 = $('#grau1').val();

    $.post('alterarmembro.php', {idusua: idusua, nome1: nome1, parentesco1: parentesco1, grau1: grau1}, function (data) {

      alert(data);
      //alert('Membro deletado com sucesso.');
      window.location.href = window.location.href
    });
  }


</script>


<!-- ======= Breadcrumbs ======= -->
<section class="breadcrumbs">
  <div class="container">
    <div class="row align-items-end">
      <div class="col-6">
        <ol>
          <li>Home</li>
          <li>Adicionar Membro da Família</li>
        </ol>
        <h2>Adicionar Membro da Família</h2>
      </div>

    </div>
  </div>
</section>

<form method="post">
  <input type="hidden" class="form-control" name="seq" id="seq" value="{SEQ}" readonly>
  <input type="hidden" id="idusua" name="idusua" value="{IDUSUA}"/>

  <section id="blog" class="blog">
    <div class="msg container">
      <!-- BEGIN ERRO -->
      <section class="about-us-section-rede">
      </section>
      <div class="alert alert-danger" role="alert">
        <p align="justify">{MSG}</p>
      </div>
      <!-- END ERRO -->

      <!-- BEGIN SUCESSO -->
      <section class="about-us-section-rede">
      </section>
      <div class="alert alert-success" role="alert">
        <p align="justify">{MSG}</p>
      </div>
      <!-- END SUCESSO -->
    </div>

    <div class="container" data-aos="fade-up">
      <h3 class="text-center">Plano Atual: {NOMEPLANO} - Máximo de Dependentes: {DEP} e Máximo Agregados: {AGR}</h3>
      <h4 class="text-center"><i>Seus Dependentes: {DEPUSUA} e Seus Agregados: {AGREUSUA}</i></h4>
      <hr>
      <div class="row">
        <div class="col-lg-6 entries">
          <div class="row">
            <h4 class="text-center" >Informações do usuários</h4>
            <div class="form-group mb-4" align="left">
              <label>NOME:</label>
              <input type="text" class="form-control" {INPUTS} name="nome" id="nome" required>
            </div>

            <div class="form-group mb-4" align="left">
              <label>E-MAIL:</label>
              <input type="email" class="form-control" {INPUTS} name="mail" id="mail" required>
            </div>

            <div class="form-group mb-4" align="left">
              <label>CPF:</label>
              <input type="text" class="cpf form-control" {INPUTS} maxlength="11" name="cpf" id="cpf" value="{CCPF}" required>
            </div>

            <div class="form-group mb-4" align="left">
              <label>CELULAR:</label>
              <input type="text" class="form-control" {INPUTS} name="phone" id="phone" required data-validation-required-message="Preencher o numero do celular">
            </div>

            <div class="form-group mb-4" align="left">
              <label>DATA DE NASCIMENTO:</label>
              <input type="text" class="form-control" {INPUTS} name="dtnasc" id="dtnasc" value="{NASC}" onblur="validacaoCalcularIdade();" onkeyup="validacaoCalcularIdade();">
              <div id="alerta3"></div>
            </div>

            <input type="hidden" name="val_acima" id="val_acima" value="{FILHOACIMA}">

            <div class="form-group mb-4" align="left">
              <label>GRAU DE PARENTESCO:</label>
              <select class="form-control" name="parentesco" {INPUTS} required>
                <option value="">{TEXTOVAZIO}</option>
                <option value="m" {MARIDO}>Marido</option>
                <option value="e" {ESPOSA}>Esposa</option>
                <option value="f" {FILHOS}>Filha(o)</option>
                <option value="n" {NETOS}>Neta(o)</option>
                <option value="p" {PAI}>Pai</option>
                <option value="a" {MAE}>Mãe</option>
                <option value="i" {IRMAO}>Irmão(ã)</option>
                <option value="s" {SOGRO}>Sogro(a)</option>
                <option value="u" {CUNHA}>Cunhado(a)</option>
              </select>
            </div>

            <div class="form-group mb-4" align="left">
              <label>GRUPO:</label>
              <select class="form-control" name="grau" {INPUTS} required>
                <option value="d" {DEPE}>Dependente</option>
                <option value="a" {AGRE}>Agregado</option>
              </select>
            </div>

            <div id="success"></div>

            <div class="input-group">
            <!-- BEGIN ADD -->
            <input type="submit" class="btn btn-primary" name="add" {DISA} value="ADICIONAR">
            <!-- END ADD -->
            </div>

            {TEXTOVAZIO}
            <br>
            <p>{TEXT}</p>

          </div>
        </div>

        <div class="col-lg-6">
          <h4 class="text-center">Lista de Membros da Família</h4>
          <table class="table">
            <tr>
              <th>Id</th>
              <th>Nome</th>
              <th>Parentesco</th>
              <th>Idade</th>
              <th>Tipo Usuario</th>
              <th>Opções</th>
            </tr>
            <!-- BEGIN MEMBROS -->
            <tr>
              <input type="hidden" name="idusuario" value="{ID}">
              <td>{ID}</td>
              <td>{NOME_M}</td>
              <td>{PARENT}</td>
              <td>{IDADE}</td>
              <td>{TIPO}</td>
              <td>
                <a href="javascript:void(0);" class="btn btn-warning" onclick="editmodal('{ID}');">
                  <i class="bx bx-edit"></i>
                </a>
                <a href="javascript:void(0);" class="btn btn-danger" onclick="abrirmodal('{ID}');">
                  <i class="bx bx-trash"></i>
                </a>
              </td>
            </tr>
            <!-- END MEMBROS -->
          </table>
        </div>
      </div>
    </div>
    </div>
  </section><!-- End Blog Section -->
</form>


<!-- Modal -->
<div class="modal fade" id="delusua" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Deletar Usuário</h5>
      </div>
      <div class="modal-header">
        <input type="hidden" id="idusu" name="idusu">
        Deseja apagar o membro?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
        <button type="button" class="btn btn-primary" onclick="apagar('{ID}');">Sim</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="editmodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Usuário</h5>
      </div>

      <div class="modal-body">
        <label>Nome:</label>
        <input type="hidden" id="idusua1" name="idusua1">
        <input type="text" class="form-control mb-4" id="nome1" name="nome1">
        <br>
        <div class="form-group mb-4">
          <label>Grau de Parentesco:</label>
          <div id="para"></div>

        </div>
        <div class="form-group mb-4">
          <label>Grupo:</label>
          <div id="grau"></div>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <a href="javascript:void(0);" class="btn btn-primary" onclick="alterar();">Alterar</a>
      </div>

    </div>
  </div>
</div>
